# MikeNakis.SvgConvert<br><sub><sup>Converts SVG files to other file formats. (PNG and ICO.)</sub></sup>

<p align="center">
  <img title="MikeNakis.SvgConvert icon" src="MikeNakis.SvgConvert/SvgConvert.ico.svg" width="256" />
</p>

[![Build](https://github.com/mikenakis/MikeNakis.SvgConvert/actions/workflows/continuous-integration.yml/badge.svg)](https://github.com/mikenakis/MikeNakis.SvgConvert/actions/workflows/SvgConvert-build-and-test-on-push.yml)

MikeNakis.SvgConvert is a cross-platform command-line utility (packaged as a dotnet tool) that can be used to convert SVG files to other file formats.

Supported formats:

- PNG
- ICO (PNG-based Windows Icon)

The generated windows-icon file has multiple resolutions, transparent background, and is PNG-based, (a feature supported by Windows since Vista,) so it can have semi-transparent pixels instead of being limited to pixels that are either fully transparent or fully opaque. In other words, the generated icon looks _perfect_.

## How it works

MikeNakis.SvgConvert makes use of **wieslawsoltes/Svg.Skia** ([GitHub](https://github.com/wieslawsoltes/Svg.Skia), [NuGet](https://www.nuget.org/packages/Svg.Skia/)) for loading SVG files and rendering them into in-memory images, and **SkiaSharp** ([GitHub](https://github.com/mono/SkiaSharp), [NuGet](https://www.nuget.org/packages/SkiaSharp)) for saving in-memory images to PNG.
MikeNakis.SvgConvert implements the logic for creating a multi-image ICO file from a series of PNG images based on information found in [Wikipedia: ICO (file_format)](https://en.wikipedia.org/wiki/ICO_(file_format)).

MikeNakis.SvgConvert _**does not**_ use the [GitHub - svg-net/SVG](https://github.com/svg-net/SVG) library anymore, because it is windows-only.

## Purpose

The main purpose of MikeNakis.SvgConvert is to allow us to create the icon of our dotnet application as an SVG file and to have the corresponding ICO file automatically generated during build.

## Advantages

1. Our icons are expressed in vector form, so they are infinitely scalable without losing quality.
1. We do not have to store any raster images (which are binary) in source control.
1. SVG files are text files, so each time we modify them our source control system can show us precisely what changes we made.
1. By incorporating SvgConvert in our build process, the conversion from SVG to ICO takes place only if the SVG file has changed.
1. Each time the SVG file changes, the corresponding ICO file is automatically generated without the need for manual steps.

## How to use MikeNakis.SvgConvert

1. Create your application icon as an SVG file and save it with an `.ico.svg` extension in your project directory.  For example, `MyApp.ico.svg`.

1. In your project file, specify that your application icon is located in `$(BaseIntermediateOutputPath)`, and that it has an `.ico` extension. For example:
    ```xml
	<Project ...>
		<PropertyGroup>
			<ApplicationIcon>$(BaseIntermediateOutputPath)$(AssemblyName).ico</ApplicationIcon>
			...
    ```

1. Further down in your project file, add the following code:
    ```
	 <!-- MikeNakis.SvgConvert boilerplate -->
	 <ItemGroup>
 		<SvgConvertInput Include="**/*.ico.svg" />
 		<AvailableItemName Include="SvgConvertInput" />
	 </ItemGroup>
	 <Target Name="SvgConvertTarget" BeforeTargets="BeforeBuild" Inputs="@(SvgConvertInput)" Outputs="@(SvgConvertInput->'$(BaseIntermediateOutputPath)%(Filename)')">
 		<Message Importance="High" Text="MikeNakis.SvgConvert %(SvgConvertInput.FullPath) $(BaseIntermediateOutputPath)%(SvgConvertInput.Filename) ==============================================================================" />
 		<Exec WorkingDirectory="$(MSBuildProjectDirectory)" Command="cmd /c MikeNakis.SvgConvert windows-ico &quot;%(SvgConvertInput.FullPath)&quot; &quot;$(BaseIntermediateOutputPath)%(SvgConvertInput.Filename)&quot;" />
	 </Target>
    ```

Note that you will probably have to modify the `cmd /c MikeNakis.SvgConvert` part
to point to the location where you have the `MikeNakis.SvgConvert` executable.  Other than that, the MikeNakis.SvgConvert boilerplate code is the same for all of your projects.

That's it. From that moment on, every time you modify an `.ico.svg` file in your project, the corresponding `.ico` file will be automatically generated during build.

Note: the above is just one way that I found to make it work. There almost certainly exist better ways. If you know of a better way, please let me know.

## Important notice about the Microsoft Visual Studio Icon Editor

If you use Visual Studio to open an ICO file generated by MikeNakis.SvgConvert, you might notice some grotesque artifacts on the fringes between transparent and opaque pixels:  Fully transparent pixels look okay, fully opaque pixels also look okay, but semi-transparent pixels appear to be rendered against a black background instead of a transparent background, which of course looks horrible.

Rest assured that these artifacts are _**not**_ actually present in the ICO file generated by MikeNakis.SvgConvert; they are only visible in the Visual Studio Icon Editor, and are exclusively due to a rendering malfunction of the Visual Studio Icon Editor.  

This is happening because Microsoft only applied a quick and dirty patch to their Icon Editor so that it just barely copes with PNG-based ICO files, (which, mind you, were introduced with Windows Vista back in 2006,) instead of properly fixing their Icon Editor to actually support PNG-based ICO files.

## Important notice about fonts

Your SVG file may be making use of fonts that are unknown to Mikenakis.SvgConvert. If this happens, then text in your SVG file will not transfer as intended to the ICO file.

One way to prevent this from happening is to make use of the "convert text to path" command of your SVG editor, so that your SVG file contains no text elements.

## License

Published under the MIT license. Do whatever you want with it.

More information: see [LICENSE.md](LICENSE.md)

## Coding style

This project uses _**my very ownâ„¢**_ coding style.

More information: see [michael.gr - On Coding Style](https://blog.michael.gr/2018/04/on-coding-style.html)

## TO DO

- Give a better example of how to use, involving `dotnet tool install`
- Research other ways of making it work
  - Namely, CoreCompat.System.Drawing or ImageSharp 
  - See https://devblogs.microsoft.com/dotnet/net-core-image-processing/

---------------

Cover image by [michael.gr](https://blog.michael.gr) including parts of ["convert" by nangicon from the Noun Project](https://thenounproject.com/icon/convert-6481628/) used under [CC BY 3.0](https://creativecommons.org/licenses/by/3.0/).
